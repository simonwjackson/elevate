---
title: Network Considerations 
description: Understanding network speed tests and latency measurements and their impact on Moonbeam streaming
sidebar:
  order: 3
---

import { Steps, Badge } from '@astrojs/starlight/components';

Moonbeam's ability to optimize your streaming experience heavily relies on understanding and adapting to your network conditions. This section will help you understand how Moonbeam interacts with your network, performs speed tests and latency measurements, and how these factors affect your streaming experience.

## Understanding Network Speed Tests

Moonbeam uses network speed tests to determine the optimal streaming settings for your current network conditions. These tests are crucial for providing you with the best possible streaming experience.

### How Moonbeam Performs Speed Tests

<Steps>

1. **Initialization**: When you start a Moonbeam streaming session, it first checks if a speed test is necessary.

2. **Connection to Host**: Moonbeam attempts to connect to your streaming host (the computer running Sunshine) on port 31347.

3. **Data Transfer**: If the connection is successful, Moonbeam uses the `iperf3` tool to perform a brief speed test.

4. **Result Analysis**: The speed test results are analyzed to determine the available bandwidth.

5. **Settings Optimization**: Based on the speed test results, Moonbeam adjusts streaming parameters such as resolution, FPS, and bitrate.

</Steps>

:::note
Moonbeam requires the `iperf3` server to be running on your streaming host for accurate speed tests. Make sure it's properly set up and running on port 31347.
:::

### Interpreting Speed Test Results

Moonbeam categorizes your network speed into different tiers, which influence the streaming settings:

- **High Speed** (30+ Mbps): Allows for high resolution and high FPS streaming.
- **Medium Speed** (15-30 Mbps): May require some compromises in resolution or FPS.
- **Low Speed** (< 15 Mbps): Will prioritize a smooth experience over high resolution.

:::tip
If you're consistently getting low speed test results, consider troubleshooting your network or moving closer to your router for a better Wi-Fi signal.
:::

### Handling Speed Test Failures

If Moonbeam fails to perform a speed test, it will:

1. Log a warning message.
2. Fall back to using estimated bitrate based on your chosen resolution and FPS.
3. Adjust settings dynamically during the stream if performance issues are detected.

<Steps>

1. Check if `iperf3` is running on your host machine:

   ```bash
   pgrep -f "iperf3 -s -p 31347"
   ```

2. If it's not running, start it manually:

   ```bash
   iperf3 -s -p 31347
   ```

3. Ensure your firewall allows traffic on port 31347.

</Steps>

## Latency Measurements and Their Impact

In addition to network speed, latency is a critical factor in the responsiveness and quality of your streaming experience. Moonbeam incorporates latency measurements to fine-tune your stream for optimal performance.

### How Moonbeam Measures Latency

Moonbeam uses a simple yet effective method to measure latency:

<Steps>

1. **Ping Test**: Moonbeam sends a series of ICMP echo requests (pings) to your streaming host.

2. **Sample Collection**: It collects multiple samples to ensure accuracy.

3. **Average Calculation**: The average round-trip time is calculated from these samples.

4. **Result Interpretation**: This average is then used as the latency measurement for optimization calculations.

</Steps>

:::note
Moonbeam uses the `ping` command with specific parameters to ensure quick and accurate measurements:

```bash
ping -c 3 -i 0.2 -W 1 $HOST
```

This sends 3 pings with a 0.2-second interval and a 1-second timeout.
:::

### Impact of Latency on Streaming

Latency affects various aspects of your streaming experience:

1. **Input Responsiveness**: Higher latency means a longer delay between your actions and seeing the results on screen.

2. **Frame Rate**: Moonbeam may adjust the target frame rate based on latency to maintain smooth playback.

3. **Video Quality**: In some cases, Moonbeam might reduce video quality to maintain responsiveness in high-latency situations.

4. **Audio Sync**: High latency can cause audio and video to become out of sync.

### Latency Thresholds and Their Effects

Moonbeam uses the following general thresholds to adjust streaming parameters:

| Latency    | Impact                                                    |
|------------|-----------------------------------------------------------|
| < 20ms     | Optimal for all streaming, including fast-paced games     |
| 20-50ms    | Good for most games and applications                      |
| 50-100ms   | Noticeable delay, may affect fast-paced games             |
| > 100ms    | Significant impact, may reduce video quality or frame rate|

:::tip
For competitive gaming or applications requiring quick reactions, prioritize lower latency. For cinematic games or productivity apps, you might prefer higher quality even with slightly increased latency.
:::

By understanding how Moonbeam performs and uses network speed tests and latency measurements, you can ensure that you're getting the most optimized streaming experience possible. Always consider both your network speed and latency when configuring Moonbeam for the best results.
